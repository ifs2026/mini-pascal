grammar miniPascal;                     // Nome da gramática ANTLR4.

options { caseInsensitive = true; }     // Permite palavras-chave em maiúscula ou minúscula.

// ============ PROGRAMA PRINCIPAL ============

program
    : PROGRAM identifier SEMI block DOT EOF  // Programa começa com "program <nome>;" e termina com ".".
    ;

identifier
    : IDENT                             // Um identificador é apenas um token IDENT.
    ;

// ============ BLOCO (DECLARAÇÕES + COMANDOS) ============

block
    : (variableDeclarationPart)? compoundStatement  // Bloco = [seção var] + begin...end (opcional declarações).
    ;

variableDeclarationPart
    : VAR variableDeclaration (SEMI variableDeclaration)* SEMI  // Seção VAR com 1+ declarações separadas por ";".
    ;

variableDeclaration
    : identifierList COLON type_        // Declaração: "x, y : integer;"
    ;

identifierList
    : identifier (COMMA identifier)*    // Lista de variáveis separadas por vírgula.
    ;

type_
    : INTEGER                           // Tipo inteiro.
    | REAL                              // Tipo real (ponto flutuante).
    | STRING                            // Tipo texto.
    | BOOLEAN                           // Tipo booleano (true/false).
    ;

// ============ COMANDOS E CONTROLE DE FLUXO ============

compoundStatement
    : BEGIN statements END              // Bloco "begin ... end".
    ;

statements
    : statement (SEMI statement)*       // Sequência de comandos separados por ";".
    ;

statement
    : simpleStatement                   // Comando simples (atribuição ou I/O).
    | structuredStatement               // Comando estruturado (if, while, for, ou novo begin...end).
    | /* vazio */                       // Comando vazio (permitido, por exemplo no else sem nada).
    ;

simpleStatement
    : assignmentStatement               // Atribuição.
    | ioStatement                       // Leitura (read) ou escrita (print).
    ;

assignmentStatement
    : identifier ASSIGN expression      // "variavel := valor;" (uso de :=).
    ;

ioStatement
    : READ LPAREN identifier (COMMA identifier)* RPAREN    // "read(x, y);" - lê uma ou mais variáveis.
    | PRINT LPAREN expression (COMMA expression)* RPAREN   // "print(expr, ...);" - imprime uma ou mais expressões.
    ;

structuredStatement
    : ifStatement                       // if/then/else.
    | whileStatement                    // while/do.
    | forStatement                      // for/do.
    | compoundStatement                 // Outro bloco begin...end (aninhamento).
    ;

ifStatement
    : IF expression THEN statement (ELSE statement)?   // "if cond then ... else ..." (else opcional).
    ;

whileStatement
    : WHILE expression DO statement     // "while cond do ...".
    ;

forStatement
    : FOR identifier ASSIGN expression (TO | DOWNTO) expression DO statement  // "for i := 1 to 5 do ..." (crescente ou decrescente).
    ;

// ============ EXPRESSÕES COM PRECEDÊNCIA ============

expression
    : simpleExpression (relationalOperator simpleExpression)?  // Expressão: [termo] [operador relacional término].
    ;

relationalOperator
    : EQUAL                             // Igual "=".
    | NOT_EQUAL                         // Diferente "<>".
    | LT                                // Menor "<".
    | LE                                // Menor ou igual "<=".
    | GE                                // Maior ou igual ">=".
    | GT                                // Maior ">".
    ;

simpleExpression
    : term (additiveOperator term)*     // Expressão aritmética com somas/subtrações e operador lógico OR.
    ;

additiveOperator
    : PLUS                              // Soma "+".
    | MINUS                             // Subtração "-".
    | OR                                // OU lógico "or".
    ;

term
    : factor (multiplicativeOperator factor)*  // Multiplicações/divisões e operador lógico AND.
    ;

multiplicativeOperator
    : STAR                              // Multiplicação "*".
    | SLASH                             // Divisão "/".
    | AND                               // E lógico "and".
    ;

factor
    : identifier                        // Variável.
    | unsignedNumber                    // Número (inteiro ou real).
    | string                            // String entre aspas.
    | boolLiteral                       // true ou false.
    | LPAREN expression RPAREN          // Expressão entre parênteses.
    | NOT factor                        // Negação lógica "not".
    | PLUS factor                       // Unário positivo "+x".
    | MINUS factor                      // Unário negativo "-x".
    ;

unsignedNumber
    : NUM_INT                           // Número inteiro sem sinal.
    | NUM_REAL                          // Número real (com ponto).
    ;

string
    : STRING_LITERAL                    // Literal de string entre aspas simples.
    ;

boolLiteral
    : TRUE                              // Booleano verdadeiro.
    | FALSE                             // Booleano falso.
    ;

// ============ LÉXICO (TOKENS) ============

// Palavras-chave
PROGRAM : 'PROGRAM';
VAR     : 'VAR';
INTEGER : 'INTEGER';
REAL    : 'REAL';
STRING  : 'STRING';
BOOLEAN : 'BOOLEAN';
READ    : 'READ';
PRINT   : 'PRINT';
BEGIN   : 'BEGIN';
END     : 'END';
IF      : 'IF';
THEN    : 'THEN';
ELSE    : 'ELSE';
WHILE   : 'WHILE';
DO      : 'DO';
FOR     : 'FOR';
TO      : 'TO';
DOWNTO  : 'DOWNTO';
TRUE    : 'TRUE';
FALSE   : 'FALSE';
NOT     : 'NOT';
AND     : 'AND';
OR      : 'OR';

// Operadores
PLUS    : '+';
MINUS   : '-';
STAR    : '*';
SLASH   : '/';
ASSIGN  : ':=';

// Símbolos de delimitação
COMMA   : ',';
SEMI    : ';';
COLON   : ':';
EQUAL   : '=';
NOT_EQUAL : '<>';
LT      : '<';
LE      : '<=';
GE      : '>=';
GT      : '>';
LPAREN  : '(';
RPAREN  : ')';
DOT     : '.';

// Identificadores e números
IDENT
    : [A-Za-z] [A-Za-z0-9_]*            // Identificador: começa com letra, continua com letra/dígito/_.
    ;

NUM_INT
    : [0-9]+                            // Número inteiro: um ou mais dígitos.
    ;

NUM_REAL
    : [0-9]+ '.' [0-9]+                 // Número real: dígitos, ponto, dígitos.
    ;

STRING_LITERAL
    : '\'' ('\'\'' | ~'\'')* '\''       // String entre apóstrofos; apóstrofo duplo '' representa um apóstrofo literal.
    ;

// Ignorar espaços em branco e comentários
WS
    : [ \t\r\n]+ -> skip                // Espaços, tabs, quebras de linha são ignorados.
    ;

COMMENT_1
    : '(*' .*? '*)' -> skip             // Comentário estilo Pascal "(* ... *)".
    ;

COMMENT_2
    : '{' .*? '}' -> skip               // Comentário estilo Pascal "{ ... }".
    ;

